# 功能规格说明: TV SnapMaster

**功能分支**: `001-tv-snapmaster`
**创建日期**: 2025-12-17
**状态**: 草稿
**输入**: 用户描述: "开发一个名为 TV SnapMaster 的 Chrome 插件，用于在 TradingView 图表页面快速切换时间周期并自动截图保存"

## 用户场景与测试 *(必填)*

### 用户故事 1 - 一键图表截图 (优先级: P1)

作为一名交易者，我希望能够快速截取指定时间周期的 TradingView 图表截图，以便保存和分享我的技术分析，无需手动截图和文件管理。

**优先级原因**: 这是插件的核心价值。没有这个功能，插件就失去了存在意义。它实现了高效截取图表截图的主要用例。

**独立测试**: 可通过点击时间周期按钮并验证截图以正确的文件名格式下载来完整测试，为需要记录分析的交易者提供即时价值。

**验收场景**:

1. **假设** 用户在显示 "BTCUSDT" 品种的 TradingView 图表页面，**当** 用户点击插件弹窗中的 "4h" 按钮，**则** 图表切换到 4 小时周期，图表完全加载后，自动下载名为 "BTCUSDT_4h_20251218_143052.png" 的截图。

2. **假设** 用户在已显示 1D 周期的 TradingView 图表页面，**当** 用户点击插件弹窗中的 "1D" 按钮，**则** 插件跳过周期切换步骤，直接截图并下载。

3. **假设** 用户在 TradingView 图表页面，**当** 插件尝试切换周期时，**则** 任何弹出对话框（如"未保存更改"警告）在继续操作前被自动关闭。

---

### 用户故事 2 - 快速多周期批量截图 (优先级: P2)

作为进行多时间周期分析的交易者，我希望能够一次选择多个时间周期进行批量截图，以便高效地获取同一品种在不同时间框架的图表截图。

**优先级原因**: 这扩展了核心功能，满足需要跨时间周期进行全面分析的用户需求，提高工作效率，避免重复操作。

**独立测试**: 可通过同时选择多个周期并点击"批量截图"按钮，验证每个周期的截图以正确的周期信息依次下载来完整测试。

**验收场景**:

1. **假设** 用户想要截取 1m、5m、15m 和 1h 周期的图表，**当** 用户选中这四个周期的复选框并点击"批量截图"按钮，**则** 插件依次切换到每个周期并截图，下载四个独立的截图文件，文件名中包含各自的周期标识。

2. **假设** 用户在批量截图过程中，**当** 插件正在处理某个周期，**则** 插件显示当前处理进度（如"正在处理 2/4：切换到 5m"），并在完成所有截图后显示成功提示。

3. **假设** 用户只选择一个周期，**当** 用户点击按钮，**则** 插件执行单个周期的截图流程，行为与直接点击单个按钮相同。

---

### 用户故事 3 - 深色模式适配 (优先级: P3)

作为使用 TradingView 深色模式的交易者，我希望插件弹窗能够匹配深色主题风格，以获得一致的视觉体验。

**优先级原因**: 虽然不是核心功能，但视觉一致性能提升用户体验，减少在深色模式环境下工作的交易者的眼睛疲劳。

**独立测试**: 可通过在 TradingView 中启用深色模式并验证插件弹窗显示匹配的深色主题来测试。

**验收场景**:

1. **假设** TradingView 处于深色模式，**当** 用户打开插件弹窗，**则** 弹窗显示与 TradingView 深色主题视觉匹配的深色配色方案。

2. **假设** TradingView 处于浅色模式，**当** 用户打开插件弹窗，**则** 弹窗显示与 TradingView 浅色主题视觉匹配的浅色配色方案。

---

### 边缘情况

- 当品种名称包含特殊字符（如 "BTC/USDT" 或 "ES1!"）时会发生什么？
  - 文件名中的特殊字符被清理（替换为下划线等安全字符）。
- 当 TradingView 图表在合理时间内无法加载时，系统如何处理？
  - 插件最多等待 10 秒让图表加载，然后继续截图或显示错误消息。
- 如果用户不在 TradingView 图表页面时点击插件会发生什么？
  - 插件显示消息，说明仅在 TradingView 图表页面有效。
- 系统如何处理慢速网络条件？
  - 延长图表加载超时时间，并在弹窗中显示加载指示器。
- 如果插件无法检测当前品种名称会发生什么？
  - 文件名使用 "unknown" 作为品种占位符，截图继续进行。

## 需求 *(必填)*

### 功能需求

- **FR-001**: 插件必须提供带有预设时间周期按钮（1m、5m、15m、1h、4h、1D、1W）的弹窗界面。
- **FR-002**: 插件必须检测并与 TradingView 的时间周期选择器交互以切换图表周期。
- **FR-003**: 插件必须在截图前检测图表是否已完成加载。
- **FR-004**: 插件必须将可见浏览器标签区域截取为 PNG 图片。
- **FR-005**: 插件必须自动下载截取的图片，文件名格式为: `{品种}_{周期}_{时间戳}.png`，时间戳格式为 `YYYYMMDD_HHmmss`。
- **FR-006**: 插件必须从 TradingView 页面提取当前品种/交易对名称。
- **FR-007**: 插件必须自动关闭可能干扰周期切换的常见 TradingView 弹窗对话框（如"未保存更改"警告）。
- **FR-008**: 如果图表已显示目标周期，插件必须跳过周期切换步骤。
- **FR-009**: 插件必须仅在 TradingView 图表页面（URL 匹配 `*://www.tradingview.com/chart/*` 和 `*://*.tradingview.com/chart/*`）上激活并运行。
- **FR-010**: 插件弹窗必须适配 TradingView 当前的颜色模式（深色/浅色）。
- **FR-011**: 插件必须在截图过程中提供视觉反馈（加载状态指示）。
- **FR-012**: 插件必须处理品种名称中的特殊字符，将其清理为安全的文件名。
- **FR-013**: 插件必须支持同时选择多个时间周期进行批量截图，每个周期生成独立的截图文件。
- **FR-014**: 插件必须按顺序处理批量截图请求，确保每个周期切换和截图完成后再进行下一个。

### 关键实体

- **品种 (Symbol)**: 交易标的标识符（如 "BTCUSDT"、"AAPL"、"ES1!"）。从 TradingView 页面提取，用于生成文件名。
- **周期 (Interval)**: 图表时间周期（如 "15m"、"1h"、"4h"、"1D"、"1W"）。同时表示按钮标签和目标图表设置。
- **截图 (Screenshot)**: 截取的可见图表区域 PNG 图片。关联品种、周期和截取时间戳。
- **截图状态 (Capture State)**: 截图操作的当前状态（空闲、切换周期中、等待加载、截图中、下载中、错误）。

## 成功标准 *(必填)*

### 可衡量结果

- **SC-001**: 当目标周期已显示时，用户可在 5 秒内完成图表截图。
- **SC-002**: 当需要切换到不同周期时（包括图表加载时间），用户可在 15 秒内完成图表截图。
- **SC-003**: 在标准 TradingView 图表页面上，95% 的截图尝试无需用户干预即可成功完成。
- **SC-004**: 下载的截图准确反映所选周期下的完整可见图表区域。
- **SC-005**: 文件名格式一致且可解析，允许用户按品种、周期和日期组织截图。
- **SC-006**: 点击插件图标后，弹窗在 500 毫秒内正确显示并可用。

## 假设

- TradingView 的图表界面结构（DOM 元素、CSS 选择器）保持相对稳定。如果 TradingView 大幅更改其界面，插件可能需要更新。
- 用户拥有足够稳定的网络连接，使 TradingView 能够正常加载图表。
- 插件在最新稳定版本的 Chrome 浏览器上运行。
- TradingView 的时间周期选择器可通过标准 DOM 操作技术访问。
- 浏览器的标签截图 API 提供足够的图片质量满足用户需求。
- 用户接受默认的 10 秒图表加载超时；初始版本不提供用户可配置的超时设置。
